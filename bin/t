#!/usr/bin/env python
import os
import pathlib
import sys


TODO_DIR = pathlib.Path.home() / "todo"


def print_todos():
    for entry in TODO_DIR.iterdir():
        if not entry.is_file():
            continue

        if entry.name == "done.txt":
            continue

        print(entry)

        with entry.open(mode="r") as f:
            lines = f.readlines()

        lines.sort()

        for todo in lines:
            if todo.startswith("x "):
                continue

            print(todo, end="")


if __name__ == "__main__":
    progname, *args = sys.argv

    if progname.endswith("t"):
        print_todos()
    elif progname.endswith("te"):
        if len(args) != 1:
            print("usage: te TODO_FILE")
            sys.exit(1)

        filename = args[0]
        todo_file = TODO_DIR / f"{filename}.txt"
        if not todo_file.exists():
            print(f"{todo_file} does not exist.")
            sys.exit(1)

        # We need to abide by UNIX conventions to set the argument at pos 0
        # to the binary name.
        os.execvp("vim", ["vim", str(todo_file)])
